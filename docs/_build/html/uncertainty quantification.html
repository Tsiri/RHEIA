

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>8. Run the uncertainty quantification &mdash; rheia  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. post-processing" href="post_processing.html" />
    <link rel="prev" title="7. Run the optimization" href="optimization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> rheia
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="functionalities.html">1. A short description</a></li>
<li class="toctree-l1"><a class="reference internal" href="connecting%20your%20own%20model.html">2. Connecting your own model</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">3. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">4. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">5. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="stochastic%20design%20space.html">6. Stochastic design space</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">7. Run the optimization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Run the uncertainty quantification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#run-uncertainty-quantification">8.1. run uncertainty quantification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#necessary-items">8.1.1. Necessary items</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-case-name">8.1.1.1. ‘case’: case_name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pol-order-pol-order">8.1.1.2. ‘pol order’: pol_order</a></li>
<li class="toctree-l4"><a class="reference internal" href="#objective-names-obj-names">8.1.1.3. ‘objective names’: obj_names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#objective-of-interest-obj-of-interest">8.1.1.4. ‘objective of interest’: obj_of_interest</a></li>
<li class="toctree-l4"><a class="reference internal" href="#results-dir-directory">8.1.1.5. ‘results dir’: directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#optional-items">8.1.2. Optional items</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sampling-method-sampling-method">8.1.2.1. ‘sampling method’: sampling_method</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-only-samples-only-samples-bool">8.1.2.2. ‘create only samples’: only_samples_bool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#draw-pdf-cdf-draw-bool-n-samples">8.1.2.3. ‘draw pdf cdf’: [draw_bool, n_samples]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#n-jobs-n-jobs">8.1.2.4. ‘n jobs’: n_jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#uncertainty-quantification-dictionary-example">8.1.3. uncertainty quantification dictionary example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-samples-for-unconnected-model">8.2. Create samples for unconnected model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#determine-the-polynomial-order">8.3. Determine the polynomial order</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="post_processing.html">9. post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="methods.html">10. Details on the methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="energy%20system%20models.html">11. Details on the energy system models</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">12. API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribution.html">13. How to contribute</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">rheia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Run the uncertainty quantification</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/uncertainty quantification.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="run-the-uncertainty-quantification">
<span id="lab-uncertaintyquantification"></span><h1><span class="section-number">8. </span>Run the uncertainty quantification<a class="headerlink" href="#run-the-uncertainty-quantification" title="Permalink to this headline">¶</a></h1>
<p>The uncertainty quantification procedure provides the mean and standard deviation of the quantity of interest and the Sobol’ indices
by constructing a Polynomial Chaos Expansion (PCE). More information on PCE is available in <a class="reference internal" href="methods.html#lab-pce"><span class="std std-ref">Polynomial Chaos Expansion</span></a>.
The mean value and the corresponding uncertainty of the model parameters are characterized in <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> and <code class="file docutils literal notranslate"><span class="pre">stochastic_space</span></code>, respectively.
More information on characterizing these files is available in <a class="reference internal" href="stochastic%20design%20space.html#lab-ssdesignspace"><span class="std std-ref">design_space</span></a> and <a class="reference internal" href="stochastic%20design%20space.html#lab-ssstochastic-space"><span class="std std-ref">stochastic_space</span></a>, respectively.
The model returns the values for the quantity of interest through the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate()</span></code> defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">case_description</span></code>.
More information on this Python wrapper is discussed in <a class="reference internal" href="connecting%20your%20own%20model.html#lab-wrapper"><span class="std std-ref">Python wrapper</span></a>.</p>
<div class="section" id="run-uncertainty-quantification">
<h2><span class="section-number">8.1. </span>run uncertainty quantification<a class="headerlink" href="#run-uncertainty-quantification" title="Permalink to this headline">¶</a></h2>
<p>To run the uncertainty quantification, first the uncertainty quantification module should be imported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rheia.UQ.uncertainty_quantification</span> <span class="k">as</span> <span class="nn">rheia_uq</span>
</pre></div>
</div>
<p>To characterize the uncertainty quantification, the following dictionary with parameters related to the case and uncertainty quantification should be completed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dict_uq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;case&#39;</span><span class="p">:</span>                  <span class="n">case_name</span><span class="p">,</span>
           <span class="s1">&#39;pol order&#39;</span><span class="p">:</span>             <span class="n">pol_order</span><span class="p">,</span>
           <span class="s1">&#39;objective names&#39;</span><span class="p">:</span>       <span class="n">obj_names</span><span class="p">,</span>
           <span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="n">obj_of_interest</span><span class="p">,</span>
           <span class="s1">&#39;results dir&#39;</span><span class="p">:</span>           <span class="n">directory</span>

           <span class="s1">&#39;sampling method&#39;</span><span class="p">:</span>       <span class="n">sampling_method</span><span class="p">,</span>        <span class="c1">#optional, default is &#39;SOBOL&#39;</span>
           <span class="s1">&#39;create only samples&#39;</span><span class="p">:</span>   <span class="n">only_samples_bool</span><span class="p">,</span>      <span class="c1">#optional, default is False</span>
           <span class="s1">&#39;draw pdf cdf&#39;</span><span class="p">:</span>          <span class="p">[</span><span class="n">draw_bool</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">],</span> <span class="c1">#optional, default is [False]</span>
           <span class="s1">&#39;n jobs&#39;</span><span class="p">:</span>                <span class="n">n_jobs</span><span class="p">,</span>                 <span class="c1">#optional, default is 1</span>
          <span class="p">}</span>
</pre></div>
</div>
<p>The items of the uncertainty quantification dictionary are described in the following subsections. This dictionary is used as the argument for the :py:func`run_uq()` function,
which initiates the uncertainty quantification procedure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rheia_uq</span><span class="o">.</span><span class="n">run_uq</span><span class="p">(</span><span class="n">dict_uq</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="necessary-items">
<h3><span class="section-number">8.1.1. </span>Necessary items<a class="headerlink" href="#necessary-items" title="Permalink to this headline">¶</a></h3>
<p>In the following subsections, the necessary items are described.
If one of these items is not provided, the code will return an error.</p>
<div class="section" id="case-case-name">
<h4><span class="section-number">8.1.1.1. </span>‘case’: case_name<a class="headerlink" href="#case-case-name" title="Permalink to this headline">¶</a></h4>
<p>The string <cite>case_name</cite> corresponds to the name of the case.
This name should be equal to the name of the folder that comprises the case, which situates in the folder that contains the cases <cite>CASES</cite>.
To illustrate, if the case is defined in <code class="file docutils literal notranslate"><span class="pre">CASES\CASE_1</span></code>,
the dictionary includes the following item:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="s1">&#39;CASE_1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="pol-order-pol-order">
<h4><span class="section-number">8.1.1.2. </span>‘pol order’: pol_order<a class="headerlink" href="#pol-order-pol-order" title="Permalink to this headline">¶</a></h4>
<p>The polynomial order corresponds to the maximum polynomial degree in the PCE.
The polynomial order is characterized by an integer, e.g. for a polynomial order of 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;pol order&#39;</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="objective-names-obj-names">
<h4><span class="section-number">8.1.1.3. </span>‘objective names’: obj_names<a class="headerlink" href="#objective-names-obj-names" title="Permalink to this headline">¶</a></h4>
<p>The PCE is constructed for only 1 quantity of interest. However, the statistical moments for several model outputs can be of interest.
To avoid that for each model output, a new set of model evaluations need to be performed, different model outputs are stored for model evaluation.
The names of the different model outputs can be provided in the list <cite>objective_names</cite>. These names are chosen freely by the user, but should be formatted in a string.
If the model returns 3 outputs, the list can be constructed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;objective names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;output_1&#39;</span><span class="p">,</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span> <span class="s1">&#39;output_3&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="objective-of-interest-obj-of-interest">
<h4><span class="section-number">8.1.1.4. </span>‘objective of interest’: obj_of_interest<a class="headerlink" href="#objective-of-interest-obj-of-interest" title="Permalink to this headline">¶</a></h4>
<p>Despite that several outputs can be returned for each model evaluation, only one output can be selected as a quantity of interest for the PCE.
The name of this quantity of interest <cite>obj_of_interest</cite> should be provided. This name should be present in the list of all the objective names.
To illustrate, if the quantity of interest is ‘output_2’, out of the list [‘output_1’, ‘output_2’, ‘output_3’], then the item in the dictionary is configurated as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="s1">&#39;output_2&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="results-dir-directory">
<h4><span class="section-number">8.1.1.5. </span>‘results dir’: directory<a class="headerlink" href="#results-dir-directory" title="Permalink to this headline">¶</a></h4>
<p>The results directory corresponds to the folder where the results are stored.
For an illustrative case <cite>CASE_1</cite>, the UQ results are saved in the folder <code class="file docutils literal notranslate"><span class="pre">RESULTS\CASE_1\UQ\results_1</span></code>
by initiating the following key-value pair in the dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;results dir&#39;</span><span class="p">:</span> <span class="n">results_1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="optional-items">
<h3><span class="section-number">8.1.2. </span>Optional items<a class="headerlink" href="#optional-items" title="Permalink to this headline">¶</a></h3>
<p>The following items are optional items. If one of these items is not provided in the dictionary,
a default value will be assigned to the key. If none of these are provided, the optional dictionary
items are defined as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;sampling method&#39;</span><span class="p">:</span>       <span class="s1">&#39;SOBOL&#39;</span><span class="p">,</span>
<span class="s1">&#39;create only samples&#39;</span><span class="p">:</span>   <span class="kc">False</span><span class="p">,</span>
<span class="s1">&#39;draw pdf cdf&#39;</span><span class="p">:</span>          <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
<span class="s1">&#39;n jobs&#39;</span><span class="p">:</span>                <span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<div class="section" id="sampling-method-sampling-method">
<h4><span class="section-number">8.1.2.1. </span>‘sampling method’: sampling_method<a class="headerlink" href="#sampling-method-sampling-method" title="Permalink to this headline">¶</a></h4>
<p>For the construction of a PCE, a number of model evaluation are required. The samples for model evaluation can be generated
in two different ways: randomly, or through a Sobol’ sequence.
The random generation is called through the string ‘RANDOM’, while the Sobol’ sequence is initiated through ‘SOBOL’.
The default configuration for generating the samples for PCE is through a Sobol’ sequence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;sampling method&#39;</span><span class="p">:</span> <span class="s1">&#39;SOBOL&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="create-only-samples-only-samples-bool">
<h4><span class="section-number">8.1.2.2. </span>‘create only samples’: only_samples_bool<a class="headerlink" href="#create-only-samples-only-samples-bool" title="Permalink to this headline">¶</a></h4>
<p>In some cases, the coupling of the system model with the framework is complex. To avoid this coupling, the samples required to determine the statistical moments
can be generated and then evaluated manually in the system model. Hence, in this first step, the framework should only generate the samples. To do so,
the Bool <cite>only_samples_bool</cite> can be set to True:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;create only samples&#39;</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>However, the default configuration sets the value of ‘create only samples’ to False:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;create only samples&#39;</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Additional information on how to create just the samples is present in <a class="reference internal" href="#lab-sscreateonlysamples"><span class="std std-ref">Create samples for unconnected model</span></a>.</p>
</div>
<div class="section" id="draw-pdf-cdf-draw-bool-n-samples">
<h4><span class="section-number">8.1.2.3. </span>‘draw pdf cdf’: [draw_bool, n_samples]<a class="headerlink" href="#draw-pdf-cdf-draw-bool-n-samples" title="Permalink to this headline">¶</a></h4>
<p>In addition to the statistical moments, the data for generation the probability density function (pdf) and cumulative distribution function (cdf) can be generated.
This information can be generated by setting the <cite>draw_bool</cite> to True and providing the number of samples evaluated on the PCE <cite>n_samples</cite>.
To illustrate, to generate pdf and cdf datapoints based on a PCE Monte Carlo evaluation with 100,000 samples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;draw pdf cdf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">]</span>
</pre></div>
</div>
<p>In the default configuration, the pdf and cdf are not generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;draw pdf cdf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="n-jobs-n-jobs">
<h4><span class="section-number">8.1.2.4. </span>‘n jobs’: n_jobs<a class="headerlink" href="#n-jobs-n-jobs" title="Permalink to this headline">¶</a></h4>
<p>The number of parallel processes can be defined by the number of available cores on the CPU.
The default value corresponds to linear processing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;n jobs&#39;</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Alternatively, the number of parallel processes can be retreived through the <cite>cpu_count</cite> function from the multiprocessing package.
After importing multiprocessing, the item can be defined by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;n jobs&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="uncertainty-quantification-dictionary-example">
<h3><span class="section-number">8.1.3. </span>uncertainty quantification dictionary example<a class="headerlink" href="#uncertainty-quantification-dictionary-example" title="Permalink to this headline">¶</a></h3>
<p>When combining the examples in the previous section, a configurated uncertainty quantification dictionary with the necessary items looks as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">rheia.UQ.uncertainty_quantification</span> <span class="k">as</span> <span class="nn">rheia_uq</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">dict_uq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="s1">&#39;CASE_1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;pol order&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;objective names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;output_1&#39;</span><span class="p">,</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span> <span class="s1">&#39;output_3&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;results dir&#39;</span><span class="p">:</span> <span class="s1">&#39;results_1&#39;</span>
   <span class="o">...</span><span class="p">:</span>            <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">rheia_uq</span><span class="o">.</span><span class="n">run_uq</span><span class="p">(</span><span class="n">dict_uq</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, a uncertainty quantification dictionary which considers random sampling and generates 100,000 PDF and CDF samples on the PCE surrogate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">rheia.UQ.uncertainty_quantification</span> <span class="k">as</span> <span class="nn">rheia_uq</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">dict_uq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="s1">&#39;CASE_1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;pol order&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;objective names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;output_1&#39;</span><span class="p">,</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span> <span class="s1">&#39;output_3&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;results dir&#39;</span><span class="p">:</span> <span class="s1">&#39;results_1&#39;</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;sampling method&#39;</span><span class="p">:</span> <span class="s1">&#39;RANDOM&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>            <span class="s1">&#39;draw pdf cdf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>            <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">rheia_uq</span><span class="o">.</span><span class="n">run_uq</span><span class="p">(</span><span class="n">dict_uq</span><span class="p">)</span>
</pre></div>
</div>
<p>The post-processing of the results is described in <a class="reference internal" href="post_processing.html#lab-uqresults"><span class="std std-ref">uncertainty quantification results</span></a>.</p>
</div>
</div>
<div class="section" id="create-samples-for-unconnected-model">
<span id="lab-sscreateonlysamples"></span><h2><span class="section-number">8.2. </span>Create samples for unconnected model<a class="headerlink" href="#create-samples-for-unconnected-model" title="Permalink to this headline">¶</a></h2>
<p>When it is burdensome to connect the system model to the framework, the framework provides the option to just generate the random samples for uncertainty quantification,
based on the stochastic space defined in <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> and <code class="file docutils literal notranslate"><span class="pre">stochastic_space</span></code>. These samples can then be evaluated in the model externally.
To generate the samples, use (or make a copy of) the <code class="file docutils literal notranslate"><span class="pre">NO_MODEL</span></code> folder in <code class="file docutils literal notranslate"><span class="pre">CASES</span></code>.
In this folder, a <code class="xref py py-mod docutils literal notranslate"><span class="pre">case_description</span></code> module is present, as well as <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> and <code class="file docutils literal notranslate"><span class="pre">stochastic_space</span></code>.
The <code class="xref py py-mod docutils literal notranslate"><span class="pre">case_description</span></code> module simply contains the instantiation of the class, as no model evaluations are required.
In <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> and <code class="file docutils literal notranslate"><span class="pre">stochastic_space</span></code>, the stochastic design space is defined. The samples can be generated, required to perform PCE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dict_uq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="s1">&#39;NO_MODEL&#39;</span><span class="p">,</span>
           <span class="s1">&#39;pol order&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
           <span class="s1">&#39;objective names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;output_1&#39;</span><span class="p">,</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span> <span class="s1">&#39;output_3&#39;</span><span class="p">],</span>
           <span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span>
           <span class="s1">&#39;results dir&#39;</span><span class="p">:</span> <span class="s1">&#39;results_1&#39;</span><span class="p">,</span>
           <span class="s1">&#39;create only samples&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
          <span class="p">}</span>
</pre></div>
</div>
<p>For this example, the samples are written in <code class="file docutils literal notranslate"><span class="pre">RESULTS\NO_MODEL\UQ\results_1\samples</span></code>. Once these samples are evaluated in the model on an external location,
the results can be added to the <code class="file docutils literal notranslate"><span class="pre">RESULTS\NO_MODEL\UQ\results_1\samples</span></code> file. When the results are added for ‘output_1’, ‘output_2’, ‘output_3’,
the PCE can be constructed for the three quantities of interest. In that case, the value for ‘create only samples’ is set back to False (i.e. the default value).
To illustrate, for a PCE on ‘output_2’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dict_uq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="s1">&#39;NO_MODEL&#39;</span><span class="p">,</span>
           <span class="s1">&#39;pol order&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
           <span class="s1">&#39;objective names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;output_1&#39;</span><span class="p">,</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span> <span class="s1">&#39;output_3&#39;</span><span class="p">],</span>
           <span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="s1">&#39;output_2&#39;</span><span class="p">,</span>
           <span class="s1">&#39;results dir&#39;</span><span class="p">:</span> <span class="s1">&#39;results_1&#39;</span><span class="p">,</span>
          <span class="p">}</span>
</pre></div>
</div>
<p>Make sure that the result directory is equal to the result directory where the updated <code class="file docutils literal notranslate"><span class="pre">samples</span></code> file is saved.</p>
</div>
<div class="section" id="determine-the-polynomial-order">
<span id="lab-detpolorder"></span><h2><span class="section-number">8.3. </span>Determine the polynomial order<a class="headerlink" href="#determine-the-polynomial-order" title="Permalink to this headline">¶</a></h2>
<p>The maximum polynomial degree for the multivariate polynomials needs to be determined up front and its value should ensure accurate
statistical moments on the quantity of interest in the considered stochastic space. An indication on the accuracy of the PCE is
the Leave-One-Out (LOO) error. If the error is below a certain threshold, the PCE achieves an acceptable accuracy. This threshold is a user-defined constant.
To ensure accurate statistical moments during the robust optimization procedure, the polynomial order should be sufficient
over the entire design space. In other words, for each design sample, the polynomial order should be sufficient to construct an accuracte PCE.
Latin Hypercube Sampling is used to construct a set of design samples, which provides a representation of the design space. If the worst-case LOO
for the corresponding PCEs is still below a certain threshold, the corresponding polynomial order can be considered sufficient to be used during
the robust optimization procedure.</p>
<p>After providing the name of the case, a dictionary with the design variable names, lower bounds and upper bounds can be defined
via the <code class="xref py py-func docutils literal notranslate"><span class="pre">get_design_variables()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">rheia.UQ.uncertainty_quantification</span> <span class="k">as</span> <span class="nn">rheia_uq</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">case</span> <span class="o">=</span> <span class="s1">&#39;case_name&#39;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">var_dict</span> <span class="o">=</span> <span class="n">rheia_uq</span><span class="o">.</span><span class="n">get_design_variables</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</pre></div>
</div>
<p>From this dictionary, the design samples can be constructed through LHS via <code class="xref py py-func docutils literal notranslate"><span class="pre">set_design_samples()</span></code>.
The number of design samples and the dictionary with information on the design variables are provided as arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">X</span> <span class="o">=</span> <span class="n">set_design_samples</span><span class="p">(</span><span class="n">var_dict</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, for each design sample in the array <cite>X</cite>, a <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> file is constructed through the function <code class="xref py py-func docutils literal notranslate"><span class="pre">write_design_space()</span></code>.
For each <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> file, the PCE can be constructed through the characterization of the uncertainty quantification dictionary.
For more information on the characterization of this dictionary, we refer to <a class="reference internal" href="#lab-uncertaintyquantification"><span class="std std-ref">Run the uncertainty quantification</span></a>.
The uncertainty quantification dictionary and the specific <code class="file docutils literal notranslate"><span class="pre">design_space</span></code> file is then provided to the <code class="xref py py-func docutils literal notranslate"><span class="pre">run_uq()</span></code> function.
In a for loop with iterations equal to the number of design samples, the PCEs are constructed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">for</span> <span class="n">iteration</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
  <span class="o">....</span><span class="p">:</span>     <span class="n">rheia_uq</span><span class="o">.</span><span class="n">write_design_space</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">var_dict</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="o">....</span><span class="p">:</span>     <span class="n">dict_uq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="n">case</span><span class="p">,</span>
  <span class="o">....</span><span class="p">:</span>                <span class="s1">&#39;pol order&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="o">....</span><span class="p">:</span>                <span class="s1">&#39;objective names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;obj_1&#39;</span><span class="p">,</span><span class="s1">&#39;obj_2&#39;</span><span class="p">],</span>
  <span class="o">....</span><span class="p">:</span>                <span class="s1">&#39;objective of interest&#39;</span><span class="p">:</span> <span class="s1">&#39;obj_1&#39;</span><span class="p">,</span>
  <span class="o">....</span><span class="p">:</span>                <span class="s1">&#39;results dir&#39;</span><span class="p">:</span> <span class="s1">&#39;res_</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">iteration</span>
  <span class="o">....</span><span class="p">:</span>               <span class="p">}</span>
  <span class="o">....</span><span class="p">:</span>     <span class="n">rheia_uq</span><span class="o">.</span><span class="n">run_uq</span><span class="p">(</span><span class="n">dict_uq</span><span class="p">,</span> <span class="n">design_space</span> <span class="o">=</span> <span class="s1">&#39;design_space_</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">iteration</span><span class="p">)</span>
</pre></div>
</div>
<p>This results in a PCE for each design sample, with a corresponding LOO error. That LOO error is stored in the <code class="file docutils literal notranslate"><span class="pre">RESULTS</span></code> folder.
Considering the specific dictionary determined above, the results for the different design samples are stored in <code class="file docutils literal notranslate"><span class="pre">\RESULTS\case\UQ</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RESULTS</span>
  <span class="n">case</span>
    <span class="n">UQ</span>
      <span class="n">res_0</span>
      <span class="n">res_1</span>
      <span class="n">res_2</span>
      <span class="n">res_3</span>
      <span class="n">res_4</span>
</pre></div>
</div>
<p>Where in each folder, the LOO error is stored in <cite>full_PCE_order_2_obj_1</cite>.</p>
<p>The worst-case LOO error (i.e. the highest LOO error over the diffferent design samples) can be determined through
the post-processing module <code class="xref py py-mod docutils literal notranslate"><span class="pre">lib_post_process</span></code>.
Instantiating an object from the <code class="xref py py-class docutils literal notranslate"><span class="pre">post_process</span></code> class is by passing the case name as an argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">rheia.POST_PROCESS.lib_post_process</span> <span class="k">as</span> <span class="nn">rheia_pp</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">my_post_process</span> <span class="o">=</span> <span class="n">rheia_pp</span><span class="o">.</span><span class="n">post_process</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</pre></div>
</div>
<p>This object is used to instantiate an object from the class <code class="xref py py-class docutils literal notranslate"><span class="pre">post_process_uq</span></code>,
by passing the arguments related to the polynomial order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">pol_order</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">my_post_process_uq</span> <span class="o">=</span> <span class="n">rheia_pp</span><span class="o">.</span><span class="n">post_process_uq</span><span class="p">(</span><span class="n">my_post_process</span><span class="p">,</span><span class="n">pol_order</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_LOO()</span></code> method returns the LOO error for every sample:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">result_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;run_</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">objective</span> <span class="o">=</span> <span class="s1">&#39;obj_1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">loo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">result_dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result_dirs</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="n">loo</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_post_process_uq</span><span class="o">.</span><span class="n">get_LOO</span><span class="p">(</span><span class="n">result_dir</span><span class="p">,</span><span class="n">objective</span><span class="p">))</span>
   <span class="o">....</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">loo</span><span class="p">))</span>
</pre></div>
</div>
<p>Based on the worst-case LOO error, the maximum polynomial degree of the PCE for the robust design optimization can be evaluated.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="post_processing.html" class="btn btn-neutral float-right" title="9. post-processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="optimization.html" class="btn btn-neutral float-left" title="7. Run the optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Diederik Coppitters, Panagiotis Tsirikoglou.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>